# export ACR=$(op read "op://FullStackAcademy/ACR/url")
# export ACR_USER=$(op read "op://FullStackAcademy/ACR/username")
# export ACR_PASSWORD=$(op read "op://FullStackAcademy/ACR/password")
IMAGE := fsa-keycloak
TAG := 24.0.1.3

.PHONY:
build-local:
	docker build --pull --no-cache -t ${IMAGE}:${TAG} . --build-arg VERSION=${TAG}

build:
	docker build --platform linux/amd64 --pull --no-cache -t ${ACR}/${IMAGE}:${TAG} . --build-arg VERSION=${TAG}

push:
	docker login -u ${ACR_USER} -p ${ACR_PASSWORD} ${ACR} ; \
	docker push ${ACR}/${IMAGE}:${TAG}

all:
	make build push
clean:
	docker rmi ${ACR}/${IMAGE}:${TAG} || true
