<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings
        xmlns="https://jakarta.ee/xml/ns/persistence/orm"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="https://jakarta.ee/xml/ns/persistence/orm
                        https://jakarta.ee/xml/ns/persistence/orm/orm_3_0.xsd"
        version="3.0">
    <entity class="com.gox.domain.entity.car.Car" access="FIELD">
        <table name="cars"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>

            <basic name="brand">
                <column name="brand"/>
            </basic>
            <basic name="model">
                <column name="model"/>
            </basic>
            <basic name="year">
                <column name="year"/>
            </basic>
            <basic name="seats">
                <column name="seats"/>
            </basic>
            <basic name="pricePerDay">
                <column name="price_per_day"/>
            </basic>
            <basic name="state">
                <column name="state"/>
                <convert converter="com.gox.jpa.converter.CarStateConverter"/>
            </basic>
            <!-- 1:1 на preview-изображение -->
            <basic name="description">
                <column name="description" nullable="true"/>
            </basic>
            <!-- связь ManyToOne на Location -->
            <many-to-one name="location" fetch="LAZY">
                <join-column name="location_id" referenced-column-name="id" nullable="true"/>
            </many-to-one>
        </attributes>
    </entity>
    <!-- Маппинг для User -->
    <entity class="com.gox.domain.entity.user.User" access="FIELD">
        <table name="users"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="name">
                <column name="name"/>
            </basic>
            <basic name="email">
                <column name="email" unique="true"/>
            </basic>
            <basic name="role">
                <column name="role"/>
                <convert converter="com.gox.jpa.converter.UserRoleConverter"/>
            </basic>
            <basic name="loyaltyLevel">
                <column name="loyalty_level"/>
                <convert converter="com.gox.jpa.converter.LoyaltyLevelConverter"/>
            </basic>
            <basic name="address">
                <column name="address" nullable="true"/>
            </basic>
            <basic name="phone">
                <column name="phone" nullable="true"/>
            </basic>
            <one-to-one name="wishlist">
                <join-column name="wishlist_id" referenced-column-name="id" unique="true"/>
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-one>
        </attributes>
    </entity>
    <!-- Маппинг для сущности Wishlist -->
    <entity class="com.gox.domain.entity.wishlist.Wishlist" access="FIELD">
        <table name="wishlists"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <!-- Связь M:N с Car через таблицу wishlist_cars -->
            <many-to-many name="cars" fetch="LAZY">
                <join-table name="wishlist_cars">
                    <join-column name="wishlist_id" referenced-column-name="id"/>
                    <inverse-join-column name="car_id" referenced-column-name="id"/>
                </join-table>
            </many-to-many>
        </attributes>
    </entity>
    <!-- Маппинг для сущности Review -->
    <entity class="com.gox.domain.entity.review.Review" access="FIELD">
        <table name="reviews"/>
        <attributes>
            <!-- Первичный ключ -->
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <!-- Поле rating (оценка) -->
            <basic name="rating">
                <column name="rating" nullable="false"/>
            </basic>
            <!-- Поле comment (текст отзыва) -->
            <basic name="comment">
                <column name="comment" nullable="true"/>
            </basic>
            <!-- Поле createdAt (время создания отзыва) -->
            <basic name="createdAt">
                <column name="created_at" nullable="false"/>
            </basic>
            <!-- Односторонняя связь: Review имеет ссылку на User -->
            <many-to-one name="user" fetch="LAZY">
                <join-column name="user_id" referenced-column-name="id" nullable="false"/>
            </many-to-one>
            <!-- Односторонняя связь: Review имеет ссылку на Car -->
            <many-to-one name="car" fetch="LAZY">
                <join-column name="car_id" referenced-column-name="id" nullable="false"/>
            </many-to-one>
        </attributes>
    </entity>

    <entity class="com.gox.domain.entity.photo.Photo" access="FIELD">
        <table name="photos"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="name">
                <column name="name"/>
            </basic>
            <basic name="content">
                <column name="content" columnDefinition="BYTEA"/>
                <lob/>
            </basic>

            <basic name="isPreview">
                <column name="is_preview"/>
            </basic>
            <many-to-one name="car" fetch="LAZY">
                <join-column name="car_id" referenced-column-name="id" nullable="false"/>
            </many-to-one>
        </attributes>
    </entity>

    <!-- Новая сущность Location -->
    <entity class="com.gox.domain.entity.location.Location" access="FIELD">
        <table name="locations"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="city">
                <column name="city"/>
            </basic>
            <basic name="street">
                <column name="street"/>
            </basic>
            <basic name="latitude">
                <column name="latitude"/>
            </basic>
            <basic name="longitude">
                <column name="longitude"/>
            </basic>
        </attributes>
    </entity>
    <!-- Маппинг сущности Booking -->
    <entity class="com.gox.domain.entity.booking.Booking" access="FIELD">
        <table name="bookings"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>

            <basic name="startDate">
                <column name="start_date" nullable="false"/>
            </basic>
            <basic name="endDate">
                <column name="end_date" nullable="false"/>
            </basic>
            <basic name="actualReturnDate">
                <column name="actual_return_date" nullable="true"/>
            </basic>
            <basic name="totalPrice">
                <column name="total_price" nullable="false"/>
            </basic>
            <basic name="transferFee">
                <column name="transfer_fee" nullable="false"/>
            </basic>
            <basic name="urgent">
                <column name="urgent" nullable="false"/>
            </basic>
            <basic name="penalty">
                <column name="penalty" nullable="false"/>
            </basic>
            <basic name="status">
                <column name="status" nullable="false"/>
                <convert converter="com.gox.jpa.converter.BookingStatusConverter"/>
            </basic>
            <!-- связи -->
            <many-to-one name="user" fetch="LAZY">
                <join-column name="user_id" referenced-column-name="id" nullable="false"/>
            </many-to-one>
            <many-to-one name="car" fetch="LAZY">
                <join-column name="car_id" referenced-column-name="id" nullable="false"/>
            </many-to-one>
            <many-to-one name="pickupLocation" fetch="LAZY">
                <join-column name="pickup_location_id" referenced-column-name="id" nullable="false"/>
            </many-to-one>
            <many-to-one name="dropoffLocation" fetch="LAZY">
                <join-column name="dropoff_location_id" referenced-column-name="id" nullable="false"/>
            </many-to-one>
        </attributes>
    </entity>
</entity-mappings>
